<!DOCTYPE html>
<html>
<head>
    <title></title>
    <style type="text/css">
        body {background: url('./inPageClouds.png') top left no-repeat;font-family:sans-serif;}

        code {font-family: "Courier New", Courier, "Lucida Sans Typewriter", "Lucida Typewriter", monospace; font-size:95%;}
        .contact {font-family: "Courier New", Courier, "Lucida Sans Typewriter", "Lucida Typewriter", monospace;
            font-size:102%;
            text-align:center}
        .contact.dot {font-weight:bold;}
        a {text-decoration:none;}
        .gist-file{
            margin-top: 10px;
            margin-right: 20px;
        }
    </style>
</head>
    <body>
        <table>
            <tr>
                <td>
                    <h2>
                        Tutorial : Log messages under a Common Identifier
                    </h2>
                </td>
                <td>
                    &nbsp;
                </td>
            </tr>
        </table><br>
        <h3>
            Objective :
        </h3>
        <table>
            <tr>
                <td>
                    <p>
                        This tutorial demonstrates the grouping of related messages under a common
                        tag.
                    </p>
                    <ul>
                        <li>
                            <b>Related Messages:</b><br>
                            Consider a valid <code>Supplier Invoice</code> that must be paid via a
                            <code>Funds Transfer Instruction</code>.<br>
                            The <code>Supplier Invoice</code> and the <code>Funds Transfer
                            Instruction</code> are two separate source documents generated on different
                            systems.<br>
                            Both documents are however related by the payment process and therefore
                            require grouping under a common tag.<br>
                            <br>
                        </li>
                        <li>
                            <b>Common Tag:</b><br>
                            An internal Salesforce ID such as <code>066b0000001RJct</code> may not be
                            useful from an end user perspective.<br>
                            An identifier such as <code>INVOICE-123</code> or <code>PMT2345</code>
                            conveys useful meaning and is therefore a better choice for a common
                            tag.<br>
                            <code>Business identifiers</code> naturally vary on a case by case
                            basis.<br>
                            It is for this reason that the framework enables the system configurator to
                            define what part of structured data will act as the common identifier
                            across disparate source documents.
                        </li>
                    </ul>
                </td>
            </tr>
            <tr>
                <td>
                    <p>
                        <b>Expected Duration :</b> 15 Minutes.
                    </p>
                </td>
            </tr>
        </table>
        <h3>
            Scenario :
        </h3>
        <table>
            <tr>
                <td>
                    <ul>
                        <li>We will model<br>
                            &nbsp; - the <i>receipt</i> of a <code>Purchase Invoice</code> ,<br>
                            &nbsp; - the <i>payment</i> of that <code>Purchase Invoice</code> using a
                            <code>Funds Transfer Instruction</code><br>
                            &nbsp; - the relationship between these two documents using their
                            respective business references
                        </li>
                        <li style="list-style: none">
                            <br>
                        </li>
                        <li>To achieve this, we will :<br>
                            &nbsp; - create two custom objects : <code>PurchaseInvoice__c</code> and
                            <code>Payment__c</code><br>
                            &nbsp; - create an ESB <b>[</b>
                            <img src="./LogUnderCommonIdentifierTutorial/PayInvoice.png" 
                                 style="vertical-align:middle;"> <b>]</b> process that simulates the payment of
                            supplier invoices.<br>
                            &nbsp; - use the <b>[</b> <img src="./LogUnderCommonIdentifierTutorial/LogWriter.png" 
                                                           style="vertical-align:middle;"> <b>]</b> and <b>[</b> 
                            <img src="./LogUnderCommonIdentifierTutorial/LogInitializer.png" 
                                 style="vertical-align:middle;"> <b>]</b> processes to relate the Purchase Invoice
                            Reference ( <code>PurchaseRef___c</code> ) and the Payment Reference (
                            <code>PaymentRef__c</code> ) .
                        </li>
                    </ul>
                </td>
            </tr>
        </table>
        <h3>
            Detailed Step - Pre-requisites :
        </h3>
        <table>
            <tr>
                <td>
                    <br>
                    <b>Note :</b> The creation of custom objects and processes will normally be
                    carried out by the developer(s) in your organisation.<br>
                    ( For detailed instructions on creating processes , see 
                    <a href="./ProcessDevelopersGuide.html" style="color: #00f;">Process Developer's
                    Guide</a>. )<br>
                    <br>
                    <ol>
                        <li>Create the Purchase Invoice object with a Reference field.<br>
                            Click <code>Setup|Create|Objects|New Custom Object</code> .<br>
                            <br>
                        </li>
                        <li>Name the object <code>PurchaseInvoice</code><br>
                            <br>
                            <img src="./LogUnderCommonIdentifierTutorial/PurchaseInvoiceDefinition.png"
                                 style="vertical-align:middle;"><br>
                            <br>
                            <br>
                            <br>
                        </li>
                        <li>Make sure it has a auto number <code>Name</code> field<br>
                            <br>
                            <img src="./LogUnderCommonIdentifierTutorial/PurchaseInvoiceAutoNumber.png"
                                 style="vertical-align:middle;"><br>
                            <br>
                            <br>
                            <br>
                        </li>
                        <li>Create a single text Reference field called <code>Invoice
                            Reference</code><br>
                            <br>
                            <img src="./LogUnderCommonIdentifierTutorial/PurchaseInvoiceReference.png"
                                 style="vertical-align:middle;"><br>
                            <br>
                            <br>
                            <br>
                        </li>
                        <li>Create a tab for the <code>PurchaseInvoice</code> object.<br>
                            <br>
                            Select <code>Setup|Create|Tabs|New</code><br>
                            Select a tab style and choose <code>PurchaseInvoice</code> for the
                            Object<br>
                            <br>
                            &nbsp; &nbsp; <img src="./LogUnderCommonIdentifierTutorial/PurchaseInvoiceTab.png" 
                                               style="vertical-align:middle;"><br>
                            <br>
                            Click [Next] , click [Next].<br>
                            On the applications screen , ensure that only the <code>Enterprise Service Bus</code> Application is selected.<br>
                            <br>
                            &nbsp; &nbsp; <img src="./LogUnderCommonIdentifierTutorial/EdaAppSelected.png" 
                                               style="vertical-align:middle;"><br>
                            <br>
                            Click <img src="./LogUnderCommonIdentifierTutorial/Save.png" 
                                       style="vertical-align:middle;"> .<br>
                            <br>
                        </li>
                        <li>Create the <code>Payment</code> object with a reference field.<br>
                            Click <code>Setup|Create|Objects|New Custom Object</code> .<br>
                            <br>
                        </li>
                        <li>Name the object <code>Payment</code><br>
                            <br>
                            <img src="./LogUnderCommonIdentifierTutorial/PaymentDefinition.png" 
                                 style="vertical-align:middle;"><br>
                            <br>
                            <br>
                            <br>
                        </li>
                        <li>Make sure the <code>Payment</code> object has a Auto Number
                            <code>Name</code> field<br>
                            <br>
                            <img src="./LogUnderCommonIdentifierTutorial/PaymentAutoNumber.png" 
                                 style="vertical-align:middle;"><br>
                            <br>
                            <br>
                            <br>
                        </li>
                        <li>Create a single text Reference field called
                            <code>PaymentReference</code><br>
                            <br>
                            <img src="./LogUnderCommonIdentifierTutorial/PaymentReference.png" 
                                 style="vertical-align:middle;"><br>
                            <br>
                            <br>
                            <br>
                        </li>
                        <li>Create a tab for the <code>Payment</code> object.<br>
                            <br>
                            Select <code>Setup|Create|Tabs|New</code><br>
                            Select a tab style and choose <code>Payment</code> for the Object<br>
                            <br>
                            &nbsp; &nbsp; <img src="./LogUnderCommonIdentifierTutorial/PaymentTab.png"
                                               style="vertical-align:middle;"><br>
                            <br>
                            Click [Next] , click [Next].<br>
                            On the applications screen , ensure that only the <code>Enterprise Service Bus</code> Application is selected.<br>
                            <br>
                            &nbsp; &nbsp; <img src="./LogUnderCommonIdentifierTutorial/EdaAppSelected.png" 
                                               style="vertical-align:middle;"><br>
                            <br>
                            Click <img src="./LogUnderCommonIdentifierTutorial/Save.png" style=
                                    "vertical-align:middle;"> .<br>
                            <br>
                        </li>
                        <li>Create the <b>[</b> <img src="./LogUnderCommonIdentifierTutorial/PayInvoice.png" 
                                                     style="vertical-align:middle;"> <b>]</b> process that simulates the payment of a
                            hypothetical inbound <code>Purchase Invoice</code> .<br>
                            Click Setup <code>|Develop|Apex Classes|New</code> .<br>
                            Paste the following code into the code window, then click 
                            <img src="./LogUnderCommonIdentifierTutorial/Save.png"
                                 style="vertical-align:middle;"> .<br>
                            <br>
                            <script src="https://gist.github.com/worslip/1927803289853b7f9a46.js" 
                                    type= "text/javascript">
                            </script><br>
                        </li>
                    </ol>
                </td>
            </tr>
        </table>
        <h3>
            Detailed Steps - Configuration :
        </h3>
        <table>
            <tr>
                <td>
                    <ul>
                        <li>Refresh the catalogue of available processes so that the <b>[</b>
                            <img src="./LogUnderCommonIdentifierTutorial/PayInvoice.png" 
                                 style="vertical-align:middle;"> <b>]</b> created earlier will be available for
                            selection during Sequence creation For specific details, refer to the
                            <a href="./ProcessDiscoveryTutorial.html" style="color: #00f;" 
                               target="_blank">Process Discovery Tutorial</a>
                        </li>
                        <li style="list-style: none">
                            <br>
                            <br>
                        </li>
                        <li>Create the <code>Purchase</code> Sequence<br>
                            <br>
                            <img src="./LogUnderCommonIdentifierTutorial/PurchaseSequence.png" 
                                 style="vertical-align:middle;"><br>
                            <br>
                        </li>
                        <li style="list-style: none">
                            <br>
                            <br>
                        </li>
                        <li>Using the New Step button, add the following steps to the
                            <code>Purchase</code> Sequence :
                            <b>[</b> 
                            <img src="./LogUnderCommonIdentifierTutorial/LogInitializer.png" 
                                 style="vertical-align:middle;"> <b>]</b> , <b>[</b> 
                            <img src="./LogUnderCommonIdentifierTutorial/LogWriter.png" 
                                 style="vertical-align:middle;"> <b>]</b> , <b>[</b> 
                            <img src="./LogUnderCommonIdentifierTutorial/Branch.png" 
                                 style="vertical-align:middle;"> <b>]</b> 
                            and <b>[</b> 
                            <img src="./LogUnderCommonIdentifierTutorial/Terminate.png" 
                                 style="vertical-align:middle;"> <b>]</b><br>
                            <br>
                            <img src="./LogUnderCommonIdentifierTutorial/PurchaseSequenceSteps.png"
                                 style="vertical-align:middle;"><br>
                            <br>
                        </li>
                        <li style="list-style: none">
                            <br>
                            <br>
                        </li>
                        <li>Create a <code>Pay</code> Sequence<br>
                            <br>
                            <img src="./LogUnderCommonIdentifierTutorial/PaySequence.png" 
                                 style="vertical-align:middle;"><br>
                            <br>
                        </li>
                        <li style="list-style: none">
                            <br>
                            <br>
                        </li>
                        <li>Using the New Step button, add the the following steps to the
                            <code>Pay</code> Sequence : <b>[</b> <img src=
                            "./LogUnderCommonIdentifierTutorial/PayInvoice.png" style=
                            "vertical-align:middle;"> <b>]</b> , <b>[</b> <img src=
                            "./LogUnderCommonIdentifierTutorial/LogInitializer.png" style=
                            "vertical-align:middle;"> <b>]</b> , <b>[</b> <img src=
                            "./LogUnderCommonIdentifierTutorial/LogWriter.png" style=
                            "vertical-align:middle;"> <b>]</b> , <b>[</b> <img src=
                            "./LogUnderCommonIdentifierTutorial/Wiretap.png" style=
                            "vertical-align:middle;"> <b>]</b> and <b>[</b> <img src=
                            "./LogUnderCommonIdentifierTutorial/Terminate.png" style=
                            "vertical-align:middle;"> <b>]</b><br>
                            <br>
                            <img src="./LogUnderCommonIdentifierTutorial/PaySequenceSteps.png" style=
                            "vertical-align:middle;"><br>
                            <br>
                        </li>
                        <li style="list-style: none">
                            <br>
                            <br>
                        </li>
                        <li>On the <code>Purchase</code> Sequence, click the 
                            <img src="./LogUnderCommonIdentifierTutorial/ConfigureLink.png" 
                                 style="vertical-align:middle;"> next to the <b>[</b> 
                            <img src="./LogUnderCommonIdentifierTutorial/LogInitializer.png" 
                                 style="vertical-align:middle;"> <b>]</b> process.<br>
                            To display the dynamic field picker, click the
                            <img src="./LogUnderCommonIdentifierTutorial/ChangeDynamicGroupIdentifierButton.png"
                                 style="vertical-align:middle;"> button. From the SOject dropdown, select
                            Purchase Invoice ( <code>PurchaseInvoice__c</code> ). Next select the
                            invoice reference reference field (<code>InvoiceReference__c</code>) from
                            the field dropdown.<br>
                            <br>
                            To complete the dynamic field selection definition, click the <b>[</b>
                            <img src="./LogUnderCommonIdentifierTutorial/SaveField.png" 
                                 style="vertical-align:middle;"> <b>]</b> button to return to the Log
                            configuration. The log configuration will now reflect the selected dynamic
                            field rom the previous step.<br>
                            <br>
                            <img src="./LogUnderCommonIdentifierTutorial/LogConfigurationPurchase.png"
                                 style="vertical-align:middle;"><br>
                            <br>
                            Close the pop-up to return to the sequence configuration
                        </li>
                        <li style="list-style: none">
                            <br>
                            <br>
                        </li>
                        <li>On the <code>Purchase</code> Sequence, Click the
                            <img src="./LogUnderCommonIdentifierTutorial/ConfigureLink.png" 
                                 style="vertical-align:middle;"> next to the <b>[</b> 
                            <img src="./LogUnderCommonIdentifierTutorial/Branch.png" 
                                 style="vertical-align:middle;"> <b>]</b> process.<br>
                        In the Sequence field, select the <code>Pay</code> Sequence<br>
                        <br>
                        <img src="./LogUnderCommonIdentifierTutorial/BranchConfigurationPurchase.png" 
                             style="vertical-align:middle;"><br>
                        <br>
                        Click 
                            <img src="./LogUnderCommonIdentifierTutorial/Save.png" 
                                 style="vertical-align:middle;"> . Close the pop-up to return to the sequence
                        configuration.
                        </li>
                        <li style="list-style: none">
                        <br>
                        <br>
                        </li>
                        <li>On the <code>Pay</code> Sequence, click the 
                            <img src="./LogUnderCommonIdentifierTutorial/ConfigureLink.png" 
                                 style="vertical-align:middle;"> next to the <b>[</b> 
                            <img src="./LogUnderCommonIdentifierTutorial/LogInitializer.png" 
                                 style="vertical-align:middle;"> <b>]</b> process.<br>
                        To display the dynamic field picker, click the 
                            <img src="./LogUnderCommonIdentifierTutorial/ChangeDynamicGroupIdentifierButton.png"
                                 style="vertical-align:middle;"> button. From the SOject dropdown, select
                        Payment ( <code>Payment__c</code> ). Next select the payment reference
                        field (<code>PaymentReference__c</code>) from the field dropdown.<br>
                        <br>
                        To complete the dynamic field selection definition, click the <b>[</b>
                        <img src="./LogUnderCommonIdentifierTutorial/SaveField.png" 
                             style="vertical-align:middle;"> <b>]</b> button to return to the Log
                        configuration. The log configuration will now reflect the selected dynamic
                        field rom the previous step.<br>
                        <br>
                        <img src="./LogUnderCommonIdentifierTutorial/LogConfigurationPayment.png"
                             style="vertical-align:middle;"><br>
                        <br>
                        Close the pop-up to return to the sequence configuration .
                        </li>
                    </ul>
                </td>
            </tr>
        </table>
        <h3>
            Detailed Steps - Create Purchase Invoice :
        </h3>
        <table>
            <tr>
                <td>
                    <ul>
                        <li>Click the Purchase Invoice tab , Click the "New" button and enter the
                            fake reference <code>"INV-09-875"</code> in the InvoiceReference
                            (InvoiceReference__c)<br>
                            <br>
                            <img src="./LogUnderCommonIdentifierTutorial/PurchaseInvoiceNew.png" 
                                 style="vertical-align:middle;"><br>
                            <br>
                        </li>
                        <li>Click <img src="./LogUnderCommonIdentifierTutorial/Save.png" 
                                       style="vertical-align:middle;"> .
                        </li>
                        <li>Copy the Id of this Purchase Invoice to the clipboard for use in the next
                            section<br>
                            <br>
                            <img src="./LogUnderCommonIdentifierTutorial/BrowserAddressBar.png" 
                                 style="vertical-align:middle;"><br>
                            <br>
                        </li>
                    </ul>
                </td>
            </tr>
        </table>
        <h3>
            Detailed Steps - Enqueue :
        </h3>
        <table>
            <tr>
                <td>
                    <ul>
                        <li>All work in the ESB framework  is initiated from the
                            <code>Broker.enqueue(Sequence , id)</code> command.
                        </li>
                        <li>The first parameter is the name of the Sequence to invoke.<br>
                        </li>
                        <li>The second parameter is the id of the document to be enqueued.
                        </li>
                        <li>To simulate the processing of the fake Purchase Invoice, we will enqueue
                            the Purchase Invoice from the Anonymous execute window.
                        </li>
                        <li>Click <code>Setup|Developer Console</code><br>
                            <img src="./LogUnderCommonIdentifierTutorial/DeveloperConsoleMenu.png"
                                 style="vertical-align:middle;"><br>
                            <br>
                        </li>
                        <li>Enter <code>Ctrl-E</code> (Windows) or <code>Cmd-E</code> (Mac) to open
                            the Anonymous Execute window;
                        </li>
                        <li>Enter <code>Broker.enqueue('Purchase','a0Pb0000004AAo5');</code> Note
                            that <code>'a0Pb0000004AAo5'</code> represents the Purchase Invoice Id copied
                            to your clipboard earlier<br>
                            <br>
                            <img src="./LogUnderCommonIdentifierTutorial/AnonymousExecute.png" 
                                 style="vertical-align:middle;"><br>
                            <br>
                        </li>
                    </ul>
                </td>
            </tr>
        </table>
        <h3>
            Detailed Steps - Review :
        </h3>
        <table>
            <tr>
                <td>
                    <ul>
                        <li>You will receive an email from the <b>[</b> 
                            <img src="./LogUnderCommonIdentifierTutorial/Wiretap.png" 
                                 style="vertical-align:middle;"> <b>]</b> process inserted towards the end of the
                            <code>Pay</code> Sequence.<br>
                        </li>
                        <li>On the <code>Purchase</code> Sequence, Click the 
                            <img src="./LogUnderCommonIdentifierTutorial/ConfigureLink.png" 
                                 style="vertical-align:middle;"> next to the <b>[</b> 
                            <img src="./LogUnderCommonIdentifierTutorial/LogInitializer.png" 
                                 style="vertical-align:middle;"> <b>]</b> process
                            </li>
                        <li>On the <code>configuration</code> view, Click the
                            <img src="./LogUnderCommonIdentifierTutorial/ListLogGroupsButton.png" 
                                 style="vertical-align:middle;"> button.
                        </li>
                        <li>This view will reconcile the progress of the message surfacing a log
                            entry wherever a <b>[</b> 
                            <img src="./LogUnderCommonIdentifierTutorial/LogWriter.png"
                                 style="vertical-align:middle;"> <b>]</b> process is encountered<br>
                            <br>
                            <img src="./LogUnderCommonIdentifierTutorial/LogWriterEntriesPurchase.png"
                                 style="vertical-align:middle;"><br>
                            <br>
                        </li>
                    </ul>
                </td>
            </tr>
        </table>
    </body>
</html>