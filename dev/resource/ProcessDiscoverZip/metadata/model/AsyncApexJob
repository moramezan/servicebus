{
    "type": "Ext.data.Model",
    "reference": {
        "name": "items",
        "type": "array"
    },
    "codeClass": null,
    "userConfig": {
        "designer|userClassName": "AsyncApexJob",
        "idProperty": "Id"
    },
    "name": "MyModel",
    "designerId": "3dcd1a61-d7b5-4a05-af36-daebda4c519c",
    "cn": [
        {
            "type": "Ext.data.field.Field",
            "reference": {
                "name": "fields",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "name": "Id"
            },
            "name": "MyField",
            "designerId": "c92d01f3-f7fd-41db-96ea-fa2f74c1a972"
        },
        {
            "type": "Ext.data.field.Date",
            "reference": {
                "name": "fields",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "name": "CompletedDate"
            },
            "name": "MyDate",
            "designerId": "23f603df-c504-49e5-9bdb-af3e88289c33",
            "cn": [
                {
                    "type": "fixedfunction",
                    "reference": {
                        "name": "items",
                        "type": "array"
                    },
                    "codeClass": null,
                    "userConfig": {
                        "designer|params": [
                            "v",
                            "rec"
                        ],
                        "fn": "convert",
                        "implHandler": [
                            "return v ? new Date(v) : null;"
                        ]
                    },
                    "name": "convert",
                    "designerId": "3c48c97d-fb40-4bb5-8639-a8d8761263de"
                }
            ]
        },
        {
            "type": "Ext.data.field.Date",
            "reference": {
                "name": "fields",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "name": "CreatedDate"
            },
            "name": "MyDate1",
            "designerId": "dd69267d-bd9b-4c21-872b-01eeb9bffbc3",
            "cn": [
                {
                    "type": "fixedfunction",
                    "reference": {
                        "name": "items",
                        "type": "array"
                    },
                    "codeClass": null,
                    "userConfig": {
                        "designer|params": [
                            "v",
                            "rec"
                        ],
                        "fn": "convert",
                        "implHandler": [
                            "return v ? new Date(v) : null;"
                        ]
                    },
                    "name": "convert",
                    "designerId": "aae76763-8fde-4422-9618-64e4645a6ff7"
                }
            ]
        },
        {
            "type": "Ext.data.field.String",
            "reference": {
                "name": "fields",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "name": "ExtendedStatus"
            },
            "name": "MyString",
            "designerId": "19dd0e68-4d7d-434f-824c-ef84d12dad85"
        },
        {
            "type": "Ext.data.field.Integer",
            "reference": {
                "name": "fields",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "name": "JobItemsProcessed"
            },
            "name": "MyInteger",
            "designerId": "0a1581ec-13a5-481d-b70c-13ce0e383840"
        },
        {
            "type": "Ext.data.field.String",
            "reference": {
                "name": "fields",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "name": "JobType"
            },
            "name": "MyString1",
            "designerId": "da21531f-56d5-4c57-8b7b-7aa369b4f9ea"
        },
        {
            "type": "Ext.data.field.String",
            "reference": {
                "name": "fields",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "name": "LastProcessed"
            },
            "name": "MyString2",
            "designerId": "1d813fe5-4b28-4bdd-9993-42fc4e4f8ec1"
        },
        {
            "type": "Ext.data.field.Integer",
            "reference": {
                "name": "fields",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "name": "LastProcessedOffset"
            },
            "name": "MyInteger1",
            "designerId": "19d370e8-fe97-44f5-8515-74eb740d90f2"
        },
        {
            "type": "Ext.data.field.Integer",
            "reference": {
                "name": "fields",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "name": "NumberOfErrors"
            },
            "name": "MyInteger2",
            "designerId": "ddd57cb8-50e3-4791-b93b-9f1dbbab4c5d"
        },
        {
            "type": "Ext.data.field.String",
            "reference": {
                "name": "fields",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "name": "Status"
            },
            "name": "MyString3",
            "designerId": "f0515e98-7ca6-4df9-a048-36d09d1e6b20"
        },
        {
            "type": "Ext.data.field.Integer",
            "reference": {
                "name": "fields",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "name": "TotalJobItems"
            },
            "name": "MyInteger3",
            "designerId": "63bd7c45-5dd2-4b95-b9d7-23e4cdd89c97"
        },
        {
            "type": "Ext.data.proxy.Direct",
            "reference": {
                "name": "proxy",
                "type": "object"
            },
            "codeClass": null,
            "userConfig": {
                "api": [
                    "{read: $RemoteAction.ProcessDiscoverController.readAsyncApexJobs}"
                ],
                "designer|createAlias": null,
                "designer|displayName": "AsyncApexJobProxy",
                "directFn": null,
                "extraParams": [
                    "{asyncApexJobId: AsyncApexJob.Id}"
                ]
            },
            "name": "MyDirectProxy",
            "designerId": "4e1c091a-daed-45a2-9b35-5e951f394925"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|params": [
                    "progressbar"
                ],
                "fn": "draw",
                "implHandler": [
                    "var job = this;",
                    "",
                    "//part bullshit progress while queueing:",
                    "//0% at 0 seconds",
                    "//6% at 1 second",
                    "//23% at 10 seconds",
                    "//46% at 100 seconds",
                    "//69% at 1000 seconds",
                    "var queuePortion = Math.log(job.countElapsedSeconds() + 1) / 10;",
                    "Ext.log('[Discover.model.AsyncApexJob] queuePortion ' + queuePortion);",
                    "",
                    "//part real progress, eg at 100 seconds in:",
                    "//46% at 0 of 100",
                    "//51% at 10 of 100",
                    "//57% at 20 of 100",
                    "//73% at 50 of 100",
                    "//95% at 90 of 100",
                    "var itemsPortion = (job.get('JobItemsProcessed') / job.get('TotalJobItems') || 0) * (1 - queuePortion); //uses || 0 to prevent NaN on divide by zero (Queued jobs have zero total items)",
                    "Ext.log('[Discover.model.AsyncApexJob] itemsPortion ' + itemsPortion);",
                    "",
                    "//add the bullshit part and the real part together",
                    "var value = queuePortion + itemsPortion;",
                    "var text = job.get('Status');",
                    "var animate = true;",
                    "",
                    "if (job.get('JobItemsProcessed')) text += ' ' + job.get('JobItemsProcessed') + ' of ' + job.get('TotalJobItems');",
                    "",
                    "progressbar.updateProgress(value, text, animate);"
                ]
            },
            "name": "draw",
            "designerId": "bdf7226e-cc42-4873-9530-c92034b3e957"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "fn": "countElapsedSeconds",
                "implHandler": [
                    "var me = this,",
                    "    timeCompleted = me.get('CompletedDate') ? me.get('CompletedDate').getTime() : new Date().getTime(),",
                    "    timeCreated = me.get('CreatedDate').getTime();",
                    "",
                    "//reports run time elapsed OR total time taken if finished",
                    "return (timeCompleted - timeCreated) / 1000;"
                ]
            },
            "name": "countElapsedSeconds",
            "designerId": "18e58a8d-55af-473a-935c-521f816f452d"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|params": [
                    "grid"
                ],
                "fn": "mask",
                "implHandler": [
                    "var elapsedSeconds = this.countElapsedSeconds();",
                    "var msg = 'The best things in life are worth waiting for... ' + Ext.Date.format(new Date(elapsedSeconds * 1000), 'i:s') + ' (<a target=\"_blank\" href=\"' + URLFOR[$Page.ProcessCsh] + '\">Help for this Page</a>)';",
                    "",
                    "//we mask the grid, not the view, because the store",
                    "//load() method periodically unmasks the gridView",
                    "if (this.get('Status') != 'Completed') grid.mask(msg);"
                ]
            },
            "name": "mask",
            "designerId": "048602e6-9d4f-4b11-a407-4e9811307db4"
        }
    ]
}