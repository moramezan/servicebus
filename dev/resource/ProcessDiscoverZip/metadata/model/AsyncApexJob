{
    "type": "Ext.data.Model",
    "reference": {
        "name": "items",
        "type": "array"
    },
    "codeClass": null,
    "userConfig": {
        "designer|userClassName": "AsyncApexJob",
        "idProperty": "Id"
    },
    "designerId": "c7d4097d-1683-471c-9f38-a448ae1f6b14",
    "cn": [
        {
            "type": "Ext.data.Field",
            "reference": {
                "name": "fields",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "name": "Id",
                "type": "auto"
            },
            "designerId": "2af62978-06b5-4791-8594-86db06a41086"
        },
        {
            "type": "Ext.data.Field",
            "reference": {
                "name": "fields",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "name": "CompletedDate",
                "type": "date"
            },
            "designerId": "11870b70-b0a8-4846-bd90-1bf489b4479f",
            "cn": [
                {
                    "type": "fixedfunction",
                    "reference": {
                        "name": "items",
                        "type": "array"
                    },
                    "codeClass": null,
                    "userConfig": {
                        "designer|params": [
                            "v",
                            "rec"
                        ],
                        "fn": "convert",
                        "implHandler": [
                            "return v ? new Date(v) : null;"
                        ]
                    },
                    "designerId": "b676a495-22b5-47e4-b02a-13f7ab42a236"
                }
            ]
        },
        {
            "type": "Ext.data.Field",
            "reference": {
                "name": "fields",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "name": "CreatedDate",
                "type": "date"
            },
            "designerId": "e59bed06-750e-445c-8aa7-cd6c0505f464",
            "cn": [
                {
                    "type": "fixedfunction",
                    "reference": {
                        "name": "items",
                        "type": "array"
                    },
                    "codeClass": null,
                    "userConfig": {
                        "designer|params": [
                            "v",
                            "rec"
                        ],
                        "fn": "convert",
                        "implHandler": [
                            "return v ? new Date(v) : null;"
                        ]
                    },
                    "designerId": "2fa599bd-3c90-464f-a6e6-3736a650bada"
                }
            ]
        },
        {
            "type": "Ext.data.Field",
            "reference": {
                "name": "fields",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "name": "ExtendedStatus",
                "type": "string"
            },
            "designerId": "306b0358-a842-430a-8491-68f79b5e5917"
        },
        {
            "type": "Ext.data.Field",
            "reference": {
                "name": "fields",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "name": "JobItemsProcessed",
                "type": "int"
            },
            "designerId": "5c248486-d9c6-40b6-b35d-38dbcbf6efaf"
        },
        {
            "type": "Ext.data.Field",
            "reference": {
                "name": "fields",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "name": "JobType",
                "type": "string"
            },
            "designerId": "8642c1ae-5c24-4799-9c2d-91fd6cd7fc17"
        },
        {
            "type": "Ext.data.Field",
            "reference": {
                "name": "fields",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "name": "LastProcessed",
                "type": "string"
            },
            "designerId": "c0552a32-d3d0-4796-8498-8cae271a6153"
        },
        {
            "type": "Ext.data.Field",
            "reference": {
                "name": "fields",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "name": "LastProcessedOffset",
                "type": "int"
            },
            "designerId": "e1131955-5953-4dbe-afed-750375f05c85"
        },
        {
            "type": "Ext.data.Field",
            "reference": {
                "name": "fields",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "name": "NumberOfErrors",
                "type": "int"
            },
            "designerId": "4c84ac8b-6a65-4adf-837f-0e87a9cfedbb"
        },
        {
            "type": "Ext.data.Field",
            "reference": {
                "name": "fields",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "name": "Status",
                "type": "string"
            },
            "designerId": "4fcf93ea-357c-44cf-b113-c043fe0c39c4"
        },
        {
            "type": "Ext.data.Field",
            "reference": {
                "name": "fields",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "name": "TotalJobItems",
                "type": "int"
            },
            "designerId": "dd67e7e9-a8c8-410c-9379-ac6dc7a39357"
        },
        {
            "type": "Ext.data.proxy.Direct",
            "reference": {
                "name": "proxy",
                "type": "object"
            },
            "codeClass": null,
            "userConfig": {
                "api": [
                    "{read: $RemoteAction.ProcessDiscoverController.readAsyncApexJobs}"
                ],
                "designer|createAlias": "vfremote",
                "designer|displayName": "AsyncApexJobProxy",
                "extraParams": [
                    "{asyncApexJobId: AsyncApexJob.Id}"
                ]
            },
            "designerId": "846ce609-25e5-4e19-9665-bb1593dea93f"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|params": [
                    "progressbar"
                ],
                "fn": "draw",
                "implHandler": [
                    "var job = this;",
                    "",
                    "//part bullshit progress while queueing:",
                    "//0% at 0 seconds",
                    "//6% at 1 second",
                    "//23% at 10 seconds",
                    "//46% at 100 seconds",
                    "//69% at 1000 seconds",
                    "var queuePortion = Math.log(job.countElapsedSeconds() + 1) / 10;",
                    "Ext.log('[Discover.model.AsyncApexJob] queuePortion ' + queuePortion);",
                    "",
                    "//part real progress, eg at 100 seconds in:",
                    "//46% at 0 of 100",
                    "//51% at 10 of 100",
                    "//57% at 20 of 100",
                    "//73% at 50 of 100",
                    "//95% at 90 of 100",
                    "var itemsPortion = (job.get('JobItemsProcessed') / job.get('TotalJobItems') || 0) * (1 - queuePortion); //uses || 0 to prevent NaN on divide by zero (Queued jobs have zero total items)",
                    "Ext.log('[Discover.model.AsyncApexJob] itemsPortion ' + itemsPortion);",
                    "",
                    "//add the bullshit part and the real part together",
                    "var value = queuePortion + itemsPortion;",
                    "var text = job.get('Status');",
                    "var animate = true;",
                    "",
                    "if (job.get('JobItemsProcessed')) text += ' ' + job.get('JobItemsProcessed') + ' of ' + job.get('TotalJobItems');",
                    "",
                    "progressbar.updateProgress(value, text, animate);"
                ]
            },
            "designerId": "1627df2d-5e55-4da7-a470-8fa8c0ba4190"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "fn": "countElapsedSeconds",
                "implHandler": [
                    "var me = this,",
                    "    timeCompleted = me.get('CompletedDate') ? me.get('CompletedDate').getTime() : new Date().getTime(),",
                    "    timeCreated = me.get('CreatedDate').getTime();",
                    "",
                    "//reports run time elapsed OR total time taken if finished",
                    "return (timeCompleted - timeCreated) / 1000;"
                ]
            },
            "designerId": "693fe634-f273-49eb-a288-755b12d73726"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|params": [
                    "grid"
                ],
                "fn": "mask",
                "implHandler": [
                    "var elapsedSeconds = this.countElapsedSeconds();",
                    "var msg = 'Discovery time ' + Ext.Date.format(new Date(elapsedSeconds * 1000), 'i:s');",
                    "",
                    "//we mask the grid, not the view, because the store",
                    "//load() method periodically unmasks the gridView",
                    "if (this.get('Status') != 'Completed') grid.mask(msg);"
                ]
            },
            "designerId": "f1767ad1-2442-4188-876b-2453b4a1537b"
        }
    ]
}