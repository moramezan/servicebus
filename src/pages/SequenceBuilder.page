<apex:page standardController="Sequence__c" extensions="SequenceBuilderExtension" action="{!initConfigure}">
    
    <apex:pageMessages showDetail="false" />
    
    <apex:sectionHeader help="{!URLFOR($Page.SequenceCsh)}" title="{!$ObjectType.Sequence__c.Label}" subtitle="{!Sequence__c.Name}" />
    
    <apex:pageBlock id="pageBlockId" title="{!$ObjectType.Step__c.LabelPlural}">
        <apex:pageBlockButtons location="top" id="pageBlockButtonsId">
            
            <!-- #768 indicate messages flowing through sequence -->
            <apex:form style="display:inline;float:right;" id="busy">
                <apex:actionPoller action="{!countRoutedMessages}" interval="5" reRender="busy" />
                <apex:outputText rendered="{!RoutedMessages > 0}" value="{!RoutedMessages}" style="position:relative;top:0px;right:8px;" title="Messages are processing" />
                <apex:image rendered="{!RoutedMessages > 0}" value="{!URLFOR('/img/loading.gif')}" style="position:relative;top:4px;" title="Messages are processing" />
            </apex:form>
            
        </apex:pageBlockButtons>
    </apex:pageBlock>
    
    <c:RemoteSiteSetting >
    <c:BootstrapExt staticResource="{!$Resource.SequenceBuilderZip}" applicationName="Builder" developmentPrefix="{!$Setup.KnifeSwitch__c.Url__c}" baseCSSPrefix="z-">
        window.$Component = window.$Component || {};
        $Component.pageBlockId = '{!$Component.pageBlockId}';
        $Component.pageBlockButtonsId = '{!$Component.pageBlockId.pageBlockButtonsId}';
        
        window.$RemoteAction = window.$RemoteAction || {};
        $RemoteAction.SequenceBuilderExtension = $RemoteAction.SequenceBuilderExtension || {};
        $RemoteAction.SequenceBuilderExtension.fetchSteps = '{!$RemoteAction.SequenceBuilderExtension.fetchSteps}';
        $RemoteAction.SequenceBuilderExtension.destroySteps = '{!$RemoteAction.SequenceBuilderExtension.destroySteps}';
        $RemoteAction.SequenceBuilderExtension.enqueue = '{!$RemoteAction.SequenceBuilderExtension.enqueue}';
        $RemoteAction.SequenceBuilderExtension.appendStep = '{!$RemoteAction.SequenceBuilderExtension.appendStep}';
        $RemoteAction.SequenceBuilderExtension.moveStepBefore = '{!$RemoteAction.SequenceBuilderExtension.moveStepBefore}';
        $RemoteAction.SequenceBuilderExtension.moveStepAfter = '{!$RemoteAction.SequenceBuilderExtension.moveStepAfter}';
        
        window.$Page = window.$Page || {};
        $Page.ProcessSettings = '{!$Page.ProcessSettings}';
        
        window.Sequence__c = window.Sequence__c || {};
        Sequence__c.Id = '{!Sequence__c.Id}';
        Sequence__c.Name = '{!JSENCODE(Sequence__c.Name)}';
        
        window.$ObjectType = window.$ObjectType || {};
        $ObjectType.Step__c = $ObjectType.Step__c || {};
        $ObjectType.Step__c.Fields = $ObjectType.Step__c.Fields || {};
        
        $ObjectType.Step__c.Fields.Id = $ObjectType.Step__c.Fields.Id || {};
        $ObjectType.Step__c.Fields.Id.Name = '{!$ObjectType.Step__c.Fields.Id.Name}';
        $ObjectType.Step__c.Fields.Name = $ObjectType.Step__c.Fields.Name || {};
        $ObjectType.Step__c.Fields.Name.Name = '{!$ObjectType.Step__c.Fields.Name.Name}';
        $ObjectType.Step__c.Fields.Sequence__c = $ObjectType.Step__c.Fields.Sequence__c || {};
        $ObjectType.Step__c.Fields.Sequence__c.Name = '{!$ObjectType.Step__c.Fields.Sequence__c.Name}';
        $ObjectType.Step__c.Fields.Position__c = $ObjectType.Step__c.Fields.Position__c || {};
        $ObjectType.Step__c.Fields.Position__c.Name = '{!$ObjectType.Step__c.Fields.Position__c.Name}';
        $ObjectType.Step__c.Fields.ConfigId__c = $ObjectType.Step__c.Fields.ConfigId__c || {};
        $ObjectType.Step__c.Fields.ConfigId__c.Name = '{!$ObjectType.Step__c.Fields.ConfigId__c.Name}';
        $ObjectType.Step__c.Fields.ConfigName__c = $ObjectType.Step__c.Fields.ConfigName__c || {};
        $ObjectType.Step__c.Fields.ConfigName__c.Name = '{!$ObjectType.Step__c.Fields.ConfigName__c.Name}';
        $ObjectType.Step__c.Fields.Process__c = $ObjectType.Step__c.Fields.Process__c || {};
        $ObjectType.Step__c.Fields.Process__c.Name = '{!$ObjectType.Step__c.Fields.Process__c.Name}';
        $ObjectType.Step__c.Fields.Process__c.RelationshipName = '{!$ObjectType.Step__c.Fields.Process__c.RelationshipName}';

        $ObjectType.Process__c = $ObjectType.Process__c || {};
        $ObjectType.Process__c.Fields = $ObjectType.Process__c.Fields || {};
        $ObjectType.Process__c.Fields.Description__c = $ObjectType.Process__c.Fields.Description__c || {};
        $ObjectType.Process__c.Fields.Description__c.Name = '{!$ObjectType.Process__c.Fields.Description__c.Name}';
        $ObjectType.Process__c.Fields.Id = $ObjectType.Process__c.Fields.Id || {};
        $ObjectType.Process__c.Fields.Id.Name = '{!$ObjectType.Process__c.Fields.Id.Name}';
        $ObjectType.Process__c.Fields.Name = $ObjectType.Process__c.Fields.Name || {};
        $ObjectType.Process__c.Fields.Name.Name = '{!$ObjectType.Process__c.Fields.Name.Name}';
        $ObjectType.Process__c.Fields.Tag__c = $ObjectType.Process__c.Fields.Tag__c || {};
        $ObjectType.Process__c.Fields.Tag__c.Name = '{!$ObjectType.Process__c.Fields.Tag__c.Name}';
        $ObjectType.Process__c.Fields.Icon__c = $ObjectType.Process__c.Fields.Icon__c || {};
        $ObjectType.Process__c.Fields.Icon__c.Name = '{!$ObjectType.Process__c.Fields.Icon__c.Name}';
        $ObjectType.Process__c.Fields.HelpUrl__c = $ObjectType.Process__c.Fields.HelpUrl__c || {};
        $ObjectType.Process__c.Fields.HelpUrl__c.Name = '{!$ObjectType.Process__c.Fields.HelpUrl__c.Name}';
        $ObjectType.Process__c.Fields.Setting__c = $ObjectType.Process__c.Fields.Setting__c || {};
        $ObjectType.Process__c.Fields.Setting__c.Name = '{!$ObjectType.Process__c.Fields.Setting__c.Name}';
        $ObjectType.Process__c.Fields.Cardinality__c = $ObjectType.Process__c.Fields.Cardinality__c || {};
        $ObjectType.Process__c.Fields.Cardinality__c.Name = '{!$ObjectType.Process__c.Fields.Cardinality__c.Name}';

        Processes = {!Processes};
        Steps = {!Steps};
        
        window.$CurrentPage = window.$CurrentPage || {};
        $CurrentPage.Url = '{!$CurrentPage.Url}';
        
        window.URLFOR = window.URLFOR || {};
        URLFOR['/'] = '{!URLFOR("/")}';
        URLFOR[$Page.ProcessSettings] = '{!URLFOR($Page.ProcessSettings)}';
    </c:BootstrapExt>
    </c:RemoteSiteSetting>

</apex:page>